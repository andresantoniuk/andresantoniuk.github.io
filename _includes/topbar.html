<!-- The Top Bar -->

<header id="topbar-wrapper" class="flex-shrink-0" aria-label="Top Bar">
  <div
    id="topbar"
    class="d-flex align-items-center justify-content-between px-lg-3 h-100"
  >
    <nav id="breadcrumb" aria-label="Breadcrumb">
      {% assign paths = page.url | split: '/' %}

      {% if paths.size == 0 or page.layout == 'home' %}
        <!-- index page -->
        <span>{{ site.data.locales[include.lang].tabs.home | capitalize }}</span>

      {% else %}
        {% for item in paths %}
          {% if forloop.first %}
            <span>
              <a href="{{ '/' | relative_url }}">
                {{- site.data.locales[include.lang].tabs.home | capitalize -}}
              </a>
            </span>

          {% elsif forloop.last %}
            {% if page.collection == 'tabs' %}
              <span>{{ site.data.locales[include.lang].tabs[item] | default: page.title }}</span>
            {% else %}
              <span>{{ page.title }}</span>
            {% endif %}

          {% elsif page.layout == 'category' or page.layout == 'tag' %}
            <span>
              <a href="{{ item | append: '/' | relative_url }}">
                {{- site.data.locales[include.lang].tabs[item] | default: page.title -}}
              </a>
            </span>
          {% endif %}
        {% endfor %}
      {% endif %}
    </nav>
    <!-- endof #breadcrumb -->

    <button type="button" id="sidebar-trigger" class="btn btn-link" aria-label="Sidebar">
      <i class="fas fa-bars fa-fw"></i>
    </button>

    <div id="topbar-title">
      {% if page.layout == 'home' %}
        {{- site.data.locales[include.lang].title | default: site.title -}}
      {% elsif page.collection == 'tabs' or page.layout == 'page' %}
        {%- capture tab_key -%}{{ page.url | split: '/' }}{%- endcapture -%}
        {{- site.data.locales[include.lang].tabs[tab_key] | default: page.title -}}
      {% else %}
        {{- site.data.locales[include.lang].layout[page.layout] | default: page.layout | capitalize -}}
      {% endif %}
    </div>

    <button type="button" id="search-trigger" class="btn btn-link" aria-label="Search">
      <i class="fas fa-search fa-fw"></i>
    </button>

    <!-- Theme Toggle Button -->
    {% unless site.theme_mode %}
      <button type="button" class="btn btn-link" aria-label="Switch Theme" id="mode-toggle" title="Toggle Dark/Light Theme">
        <i class="fas fa-adjust"></i>
      </button>
    {% endunless %}

    <div id="lang-selector">
      {% comment %}
        Detect current language based on URL
        - If URL contains '/es/', current language is Spanish
        - Otherwise, current language is English
      {% endcomment %}
      {% if page.url contains '/es/' %}
        {% assign current_lang = 'es' %}
      {% else %}
        {% assign current_lang = 'en' %}
      {% endif %}
      
      {% for lang in site.languages %}
        {% if lang == current_lang %}
          <span class="btn btn-link disabled" style="cursor: default;">
            {% if lang == 'en' %}ðŸ‡¬ðŸ‡§{% elsif lang == 'es' %}ðŸ‡ªðŸ‡¸{% endif %} {{ lang | upcase }}
          </span>
        {% else %}
          {% if page.layout == 'post' and page.translation_id %}
            {% comment %}
              For posts with translation_id, find the target language version
            {% endcomment %}
            {% assign target_post = null %}
            {% if lang == 'es' %}
              {% for post in site.posts-es %}
                {% if post.translation_id == page.translation_id %}
                  {% assign target_post = post %}
                  {% break %}
                {% endif %}
              {% endfor %}
            {% else %}
              {% for post in site.posts %}
                {% if post.translation_id == page.translation_id %}
                  {% assign target_post = post %}
                  {% break %}
                {% endif %}
              {% endfor %}
            {% endif %}
            
            {% if target_post %}
              <a href="{{ target_post.url | relative_url }}" class="btn btn-link">
                {% if lang == 'en' %}ðŸ‡¬ðŸ‡§{% elsif lang == 'es' %}ðŸ‡ªðŸ‡¸{% endif %} {{ lang | upcase }}
              </a>
            {% else %}
              {% comment %}
                No translation available, offer Google Translate
              {% endcomment %}
              <a href="https://translate.google.com/translate?sl={{ current_lang }}&tl={{ lang }}&u={{ site.url }}{{ page.url }}" 
                 class="btn btn-link" target="_blank" rel="noopener" 
                 title="{% if lang == 'en' %}Translate to English{% else %}Traducir al EspaÃ±ol{% endif %}">
                {% if lang == 'en' %}ðŸ‡¬ðŸ‡§{% elsif lang == 'es' %}ðŸ‡ªðŸ‡¸{% endif %} {{ lang | upcase }}
                <i class="fas fa-external-link-alt ms-1" style="font-size: 0.7em;"></i>
              </a>
            {% endif %}
          {% else %}
            {% comment %}
              For non-post pages, generate appropriate language-specific URLs
            {% endcomment %}
            {% if lang == 'es' %}
              {% comment %} Switch to Spanish version {% endcomment %}
              {% if page.url == '/' %}
                <a href="/es/" class="btn btn-link">ðŸ‡ªðŸ‡¸ {{ lang | upcase }}</a>
              {% elsif page.url contains '/categories/' %}
                <a href="/es/categories/" class="btn btn-link">ðŸ‡ªðŸ‡¸ {{ lang | upcase }}</a>
              {% elsif page.url contains '/tags/' %}
                <a href="/es/tags/" class="btn btn-link">ðŸ‡ªðŸ‡¸ {{ lang | upcase }}</a>
              {% elsif page.url contains '/archives/' %}
                <a href="/es/archives/" class="btn btn-link">ðŸ‡ªðŸ‡¸ {{ lang | upcase }}</a>
              {% elsif page.url contains '/about/' %}
                <a href="/es/about/" class="btn btn-link">ðŸ‡ªðŸ‡¸ {{ lang | upcase }}</a>
              {% else %}
                {% comment %} For other pages, add /es/ prefix {% endcomment %}
                <a href="{{ '/es' | append: page.url | relative_url }}" class="btn btn-link">ðŸ‡ªðŸ‡¸ {{ lang | upcase }}</a>
              {% endif %}
            {% else %}
              {% comment %} Switch to English version {% endcomment %}
              {% if page.url == '/es/' %}
                <a href="/" class="btn btn-link">ðŸ‡¬ðŸ‡§ {{ lang | upcase }}</a>
              {% elsif page.url contains '/es/categories/' %}
                <a href="/categories/" class="btn btn-link">ðŸ‡¬ðŸ‡§ {{ lang | upcase }}</a>
              {% elsif page.url contains '/es/tags/' %}
                <a href="/tags/" class="btn btn-link">ðŸ‡¬ðŸ‡§ {{ lang | upcase }}</a>
              {% elsif page.url contains '/es/archives/' %}
                <a href="/archives/" class="btn btn-link">ðŸ‡¬ðŸ‡§ {{ lang | upcase }}</a>
              {% elsif page.url contains '/es/about/' %}
                <a href="/about/" class="btn btn-link">ðŸ‡¬ðŸ‡§ {{ lang | upcase }}</a>
              {% else %}
                {% comment %} For other pages, remove /es/ prefix {% endcomment %}
                <a href="{{ page.url | replace: '/es', '' | relative_url }}" class="btn btn-link">ðŸ‡¬ðŸ‡§ {{ lang | upcase }}</a>
              {% endif %}
            {% endif %}
          {% endif %}
        {% endif %}
      {% endfor %}
    </div>

    <search id="search" class="align-items-center ms-3 ms-lg-0">
      <i class="fas fa-search fa-fw"></i>
      <input
        class="form-control"
        id="search-input"
        type="search"
        aria-label="search"
        autocomplete="off"
        placeholder="{{ site.data.locales[include.lang].search.hint | capitalize }}..."
      >
    </search>
    <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">s
      {{- site.data.locales[include.lang].search.cancel -}}
    </button>
  </div>
</header>
