<!-- Translation fallback notice -->
{% comment %}
  This include provides Google Translate fallback for posts without translations
  - Only shows if there's no translation_id or only one translation available
  - Provides Google Translate option for the alternative language
{% endcomment %}

{% comment %}
  Detect current language based on URL and post collection
{% endcomment %}
{% assign current_lang = 'en' %}
{% if page.url contains '/es/' or page.collection == 'posts-es' %}
  {% assign current_lang = 'es' %}
{% endif %}

{% comment %}
  Only show translation notice if we're on a post page and no translations are available
{% endcomment %}
{% if page.layout == 'post' %}
  {% assign has_translations = false %}
  {% if page.translation_id %}
    {% assign translation_count = 0 %}
    {% for post in site.posts %}
      {% if post.translation_id == page.translation_id %}
        {% assign translation_count = translation_count | plus: 1 %}
      {% endif %}
    {% endfor %}
    {% for post in site.posts-es %}
      {% if post.translation_id == page.translation_id %}
        {% assign translation_count = translation_count | plus: 1 %}
      {% endif %}
    {% endfor %}
    {% if translation_count > 1 %}
      {% assign has_translations = true %}
    {% endif %}
  {% endif %}

  {% unless has_translations %}
    <div class="translation-notice alert alert-info" role="alert">
      <div class="d-flex align-items-center">
        <i class="fas fa-language me-2"></i>
        <div>
          {% if current_lang == 'en' %}
            <strong>🌐 Translation Notice:</strong> {{ site.data.locales[lang].post.no_translation }}
            <div class="mt-2">
              <a href="https://translate.google.com/translate?sl=en&tl=es&u={{ site.url }}{{ page.url }}" 
                 class="btn btn-sm btn-outline-primary" target="_blank" rel="noopener">
                <i class="fas fa-language me-1"></i>{{ site.data.locales[lang].post.translate_with_google }}
              </a>
            </div>
          {% else %}
            <strong>🌐 Aviso de Traducción:</strong> {{ site.data.locales[lang].post.no_translation }}
            <div class="mt-2">
              <a href="https://translate.google.com/translate?sl=es&tl=en&u={{ site.url }}{{ page.url }}" 
                 class="btn btn-sm btn-outline-primary" target="_blank" rel="noopener">
                <i class="fas fa-language me-1"></i>{{ site.data.locales[lang].post.translate_with_google }}
              </a>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  {% endunless %}
{% endif %}
