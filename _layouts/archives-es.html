---
layout: page
# All the Archives of Spanish posts
---

{% include lang.html %}

{% assign HEAD_PREFIX = 'h_' %}
{% assign LIST_PREFIX = 'l_' %}

{% assign group_index = 0 %}

{% comment %}
  Create a comprehensive archive list for Spanish pages:
  1. First show all Spanish posts
  2. Then show English posts that don't have Spanish translations
  3. Sort by date within each group
  4. Use filename matching to prevent duplication
{% endcomment %}

{% comment %}
  Get all Spanish posts sorted by date
{% endcomment %}
{% assign spanish_posts = site.posts-es | sort: 'date' | reverse %}

{% comment %}
  Get English posts that don't have Spanish translations
  Using filename matching to identify related posts instead of date matching
{% endcomment %}
{% assign english_posts_without_translations = '' | split: '' %}
{% for english_post in site.posts %}
  {% assign has_spanish_translation = false %}
  {% for spanish_post in site.posts-es %}
    {% comment %}
      Check if this is the same post by comparing filenames
      Extract base filename (without date prefix) for comparison
    {% endcomment %}
    {% assign english_filename = english_post.name | remove: '.md' %}
    {% assign spanish_filename = spanish_post.name | remove: '.md' %}
    
    {% comment %}
      Remove date prefix (YYYY-MM-DD-) from filenames to get base names
    {% endcomment %}
    {% assign english_base = english_filename | split: '-' | slice: 3, 999 | join: '-' %}
    {% assign spanish_base = spanish_filename | split: '-' | slice: 3, 999 | join: '-' %}
    
    {% if english_base == spanish_base %}
      {% assign has_spanish_translation = true %}
      {% break %}
    {% endif %}
  {% endfor %}
  {% unless has_spanish_translation %}
    {% assign english_posts_without_translations = english_posts_without_translations | push: english_post %}
  {% endunless %}
{% endfor %}
{% assign english_posts_without_translations = english_posts_without_translations | sort: 'date' | reverse %}

{% comment %}
  Combine all posts and group by year
{% endcomment %}
{% assign all_posts = spanish_posts | concat: english_posts_without_translations %}
{% assign posts_by_year = all_posts | group_by_exp: "post", "post.date | date: '%Y'" | sort: "name" | reverse %}

{% for year in posts_by_year %}
  {% assign year_posts = year.items | sort: 'date' | reverse %}
  
  <div class="card categories">
    <div
      id="{{ HEAD_PREFIX }}{{ group_index }}"
      class="card-header d-flex justify-content-between hide-border-bottom"
    >
      <span class="ms-2">
        <i class="far fa-calendar fa-fw"></i>
        {{ year.name }}
        <span class="text-muted small font-weight-light">
          {{ year_posts.size }}
          {% if year_posts.size > 1 %}
            {{ site.data.locales[lang].archives.post_measure.plural | default: site.data.locales[lang].archives.post_measure | default: 'posts' }}
          {% else %}
            {{ site.data.locales[lang].archives.post_measure.singular | default: site.data.locales[lang].archives.post_measure | default: 'post' }}
          {% endif %}
        </span>
      </span>
    </div>

    <div id="{{ LIST_PREFIX }}{{ group_index }}" class="collapse show">
      <ul class="list-group list-group-flush">
        {% for post in year_posts %}
          <li class="list-group-item px-3">
            <a href="{{ post.url | relative_url }}" class="d-flex">
              <span class="text-muted small">{{ post.date | date: '%Y-%m-%d' }}</span>
              <span class="ms-3">
                {% if post.collection == 'posts-es' %}
                  ðŸ‡ªðŸ‡¸ {{ post.title }}
                {% else %}
                  ðŸ‡¬ðŸ‡§ {{ post.title }}
                  <small class="text-muted d-block mt-1">
                    <i class="fas fa-language me-1"></i>
                    Solo disponible en inglÃ©s
                  </small>
                {% endif %}
              </span>
            </a>
          </li>
        {% endfor %}
      </ul>
    </div>
  </div>

  {% assign group_index = group_index | plus: 1 %}
{% endfor %}
